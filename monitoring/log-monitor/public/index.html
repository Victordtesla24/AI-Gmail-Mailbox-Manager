
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gmail UI - Live Monitoring</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: #fff; }
        .header { background: #2d3748; padding: 1rem; border-bottom: 2px solid #4a5568; }
        .header h1 { color: #63b3ed; }
        .status { display: flex; gap: 1rem; margin-top: 0.5rem; }
        .status-item { padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.875rem; }
        .status-online { background: #38a169; }
        .status-offline { background: #e53e3e; }
        .container { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; padding: 1rem; height: calc(100vh - 120px); }
        .panel { background: #2d3748; border-radius: 8px; padding: 1rem; overflow: hidden; display: flex; flex-direction: column; }
        .panel h2 { color: #63b3ed; margin-bottom: 1rem; font-size: 1.125rem; }
        .logs { flex: 1; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.875rem; }
        .log-entry { padding: 0.25rem 0; border-bottom: 1px solid #4a5568; }
        .log-timestamp { color: #a0aec0; font-size: 0.75rem; }
        .log-message { margin-top: 0.25rem; }
        .log-error { color: #fc8181; }
        .log-warning { color: #f6e05e; }
        .log-auth { color: #68d391; }
        .log-info { color: #cbd5e0; }
        .alerts { position: fixed; top: 1rem; right: 1rem; z-index: 1000; }
        .alert { background: #e53e3e; color: white; padding: 1rem; border-radius: 4px; margin-bottom: 0.5rem; max-width: 400px; animation: slideIn 0.3s ease; }
        .alert-critical { background: #c53030; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
        .metric { background: #4a5568; padding: 1rem; border-radius: 4px; text-align: center; }
        .metric-value { font-size: 2rem; font-weight: bold; color: #63b3ed; }
        .metric-label { color: #a0aec0; font-size: 0.875rem; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Gmail Management UI - Live Production Monitoring</h1>
        <div class="status">
            <div id="connection-status" class="status-item status-offline">Disconnected</div>
            <div id="app-status" class="status-item status-offline">App Status: Unknown</div>
            <div id="tunnel-status" class="status-item status-offline">Tunnel: Unknown</div>
        </div>
    </div>

    <div class="container">
        <div class="panel">
            <h2>üîê Authentication & Session Logs</h2>
            <div id="auth-logs" class="logs"></div>
        </div>
        
        <div class="panel">
            <h2>‚ùå Error & Warning Logs</h2>
            <div id="error-logs" class="logs"></div>
        </div>
        
        <div class="panel">
            <h2>üì° Network & API Requests</h2>
            <div id="network-logs" class="logs"></div>
        </div>
        
        <div class="panel">
            <h2>üîÑ All Application Logs</h2>
            <div id="all-logs" class="logs"></div>
        </div>
    </div>

    <div id="alerts" class="alerts"></div>

    <script>
        const socket = io();
        let logCount = { auth: 0, error: 0, network: 0, all: 0 };

        // Connection status
        socket.on('connect', () => {
            document.getElementById('connection-status').textContent = 'Connected';
            document.getElementById('connection-status').className = 'status-item status-online';
        });

        socket.on('disconnect', () => {
            document.getElementById('connection-status').textContent = 'Disconnected';
            document.getElementById('connection-status').className = 'status-item status-offline';
        });

        // Log handling
        socket.on('log', (logEntry) => {
            addLogEntry(logEntry);
            updateStatus(logEntry);
        });

        socket.on('initial-logs', (logs) => {
            logs.forEach(log => addLogEntry(log));
        });

        socket.on('alert', (alert) => {
            showAlert(alert);
        });

        function addLogEntry(logEntry) {
            const timestamp = new Date(logEntry.timestamp).toLocaleTimeString();
            const logHtml = `
                <div class="log-entry">
                    <div class="log-timestamp">[${timestamp}] ${logEntry.file}</div>
                    <div class="log-message log-${logEntry.level}">${escapeHtml(logEntry.message)}</div>
                </div>
            `;

            // Add to appropriate panels
            if (logEntry.level === 'auth' || logEntry.message.toLowerCase().includes('auth') || 
                logEntry.message.toLowerCase().includes('login') || logEntry.message.toLowerCase().includes('session')) {
                addToPanel('auth-logs', logHtml);
                logCount.auth++;
            }

            if (logEntry.level === 'error' || logEntry.level === 'warning') {
                addToPanel('error-logs', logHtml);
                logCount.error++;
            }

            if (logEntry.message.includes('GET ') || logEntry.message.includes('POST ') || 
                logEntry.message.includes('API') || logEntry.message.includes('http')) {
                addToPanel('network-logs', logHtml);
                logCount.network++;
            }

            addToPanel('all-logs', logHtml);
            logCount.all++;
        }

        function addToPanel(panelId, html) {
            const panel = document.getElementById(panelId);
            panel.insertAdjacentHTML('beforeend', html);
            
            // Keep only last 100 entries
            while (panel.children.length > 100) {
                panel.removeChild(panel.firstChild);
            }
            
            // Auto-scroll to bottom
            panel.scrollTop = panel.scrollHeight;
        }

        function updateStatus(logEntry) {
            // Update app status based on logs
            if (logEntry.message.includes('Ready in') || logEntry.message.includes('‚úì Ready')) {
                document.getElementById('app-status').textContent = 'App Status: Running';
                document.getElementById('app-status').className = 'status-item status-online';
            }

            // Update tunnel status
            if (logEntry.file === 'localtunnel.log' && logEntry.message.includes('your url is:')) {
                document.getElementById('tunnel-status').textContent = 'Tunnel: Active';
                document.getElementById('tunnel-status').className = 'status-item status-online';
            }
        }

        function showAlert(alert) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${alert.type}`;
            alertDiv.innerHTML = `
                <strong>${alert.type.toUpperCase()}</strong><br>
                <small>${alert.file} - ${new Date(alert.timestamp).toLocaleTimeString()}</small><br>
                ${escapeHtml(alert.message)}
            `;
            
            document.getElementById('alerts').appendChild(alertDiv);
            
            // Remove alert after 10 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 10000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Check app status periodically
        setInterval(async () => {
            try {
                const response = await fetch('https://chubby-pants-speak.loca.lt');
                if (response.ok) {
                    document.getElementById('app-status').textContent = 'App Status: Running';
                    document.getElementById('app-status').className = 'status-item status-online';
                } else {
                    document.getElementById('app-status').textContent = 'App Status: Error';
                    document.getElementById('app-status').className = 'status-item status-offline';
                }
            } catch (error) {
                document.getElementById('app-status').textContent = 'App Status: Offline';
                document.getElementById('app-status').className = 'status-item status-offline';
            }
        }, 30000);
    </script>
</body>
</html>
